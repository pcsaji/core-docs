
# IOS MCN v0.1.0 Agartala Release Installation Guide: SD-Core v0.1

# Introduction

The core software for the India Open Source for Mobile Communication Network (IOS-MCN) is based on open-source SD-Core. In this document, includes the installation and configurations for making the platform up and running for the integration with RAN and UPF. This includes emulated RAN test with built in tool.

#  Purpose and Audience

This document is for installing and configuring the IOS-MCN core software on the server. It can be connected to RAN, attach UEs and integrate with UPF.

#  Installation methods

The installation can be proceeded with this documentation and the core can get from IOS-MCN git repository.  The details of each step are given on next section.

#  Installation

##  Hardware Requirements

The SD-Core installation requires the following prerequisites

- 4 Cores

- 16 GB RAM

- 40 GB Disk Storage

##  Software Prerequisites

- Ubuntu 20.04 LTS Operating system

- Git

- Curl

- Make

- Net tools

- Netplan

- Ansible

- Python3

- Docker.io

- Ethtool

##   Prerequisite Installation

Login to the Ubuntu 22.04.5 LTS desktop and take a terminal. The internet access is required for the machine.

Update the repository by the command

_sudo apt update_

After the successful completion of repository update start installing the required tools.

_sudo apt install git curl make net-tools pipx python3-venv docker.io_

_pipx install --include-deps ansible_

_pipx ensurepath_

_sudo apt install sshpass netplan.io iptables ethtool_

##  Prerequisite Environment

###  Firewall status

Verify the firewall is inactive on the system using the command

_sudo ufw status_

If the firewall is active, disable the firewall using the command

_sudo ufw disable_

###  Networkd status

Verify the _systemd-networkd_ status for the network configuration using the command

_systemctl status systemd-networkd.service_

###  Disable Generic receive offload (GRO)

Find the interface from the _ifconfig_ command and input the interface name to the following command

_sudo ethtool -K <core-interface> gro off_

##  Installation of IOS-MCN Core

###  Clone aether onramp repo

create a directory for IOS-MCN in home directory

_cd_

_mkdir SD-Core_

_cd SD-Core_

_git clone --recursive https://github.com/5GC-DEV/IOSMCN-CoreDpm.git_

This brings up a Kubernetes cluster, deploy a 5G version of SD-Core on that cluster, and then connect that SD-Core to either an emulated 5G RAN or physical RAN.

_cd IOSMCN-CoreDpm/_

###  Target Parameter Settings

Open the hosts.ini file

_vi hosts.ini_

Update IP address, username and password of the system

eg.,

_node1  ansible_host=10.176.26.86 ansible_user=ios5gn ansible_password=ios5gn ansible_sudo_pass=ios5gn_

Open vars/main.yml

_vi  vars/main.yml_

Update data_iface name on _core_:

eg.,

_data_iface: ens3_

Update data_iface name on _gnbsim:router:_

_gnbsim:_

_router:_

_data_iface: ens3_

Update IP address of the system

_amf:_

_ip: "10.176.26.86"_

Open _locale_ file

_vi /etc/default/locale_

eg.,

_#  File generated by update-locale_

_LANG="en_IN.UTF-8"_

_LANGUAGE="en_IN:en"_

<![if !vml]>![](file:///installimage002.gif)<![if !vml]>![](file:///installimage004.gif)<![if !vml]>![](file:///installimage006.jpg)

Figure 1: Parameter settings in var/main.yml

###   Install Kubernetes

Start installation with the command

_make aether-k8s-install_

This may take several minutes to complete the installation. On its completion, verify the installation status by the command

_kubectl get pods --all-namespaces_

The successful output looks like

<![if !vml]>![](file:///installimage008.jpg)

Figure 2:Output of Kubernetes installation

###  Pre-Configuration for SD-Core

Verify the netpan is configured with ip, gateway and dns address.

eg.,

_network:_

_version: 2_

_ethernets:_

_ens3:_

_addresses:_

_- 10.176.26.86/23_

_gateway4: 10.176.26.1_

_nameservers:_

_addresses:_

_- 10.176.0.11_

If any change on the configuration, execute the command

_sudo netplan apply_

Login to the docker registry using github username and access token

_sudo docker login ghcr.io -u <github-id> --password-stdin <<< <access-token>_

_Eg.,_

_sudo docker login ghcr.io -u ios5gn --password-stdin <<<  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_

###  Configure SD-Core

Modify the subscribers block of the omec-sub-provision section in file deps/5gc/roles/core/templates/ sdcore-5g-values.yaml to record the IMSI, OPc, and Key values configured onto your SIM cards. For example, the following code block adds IMSIs between 001010000000001 and 001010000000003

<![if !vml]>![](file:///installimage010.gif)

Further down in the same omec-sub-provision section you will find two other blocks that also need to be edited. The first, device-groups, assigns IMSIs to _Device Groups_. You will need to reenter the individual IMSIs from the subscribers block that will be part of the device-group. Also, update the DNS.

<![if !vml]>![](file:///installimage012.gif)

The second block, network-slices, sets various parameters associated with the _Slices_ that connect device groups to applications. Here, you will need to reenter the PLMN information

<![if !vml]>![](file:///installimage014.gif)

###  Install SD Core

Initiate the installation by the command

_make aether-5gc-install_

The successful outcome shall be verified using the following command

_kubectl get pods -n ios-mcn_

<![if !vml]>![](file:///installimage016.jpg)

_Fig.3 Success state of SD-Core installation_

##  Disable Load Balancer

$ kubectl edit cm amf -n ios-mcn

Update Sctplb to false and change mcc,mnc,sst and sd based on the  sdcore-5g-values.yaml configuration

<![if !vml]>![](file:///installimage018.gif)

Delete amf pod for update

$kubectl delete pod <pod-name> -n ios-mcn

##  Install Management Application

###  Install Aether AMP

_make aether-amp-install_

If an error occurs, try to install again

###  Access Management Interface

Access the dashboards for Aether's Runtime Control system and Aether's Monitoring system using the following URL:

http://<server_ip>:31194

Access the Grafana using the URL

http://<server_ip>:30950

##  Add Route in gNB

_sudo ip route add 192.168.252.0/24 via <core_ip>_

##  Verify Network

###  Check core and access are properly configured outside the container

There are two bridges that connect the physical interface with the UPF container. The access bridge connects the UPF downstream to the RAN (this corresponds to 3GPP’s N3 interface) and is assigned IP subnet 192.168.252.0/24 . The core bridge connects the UPF upstream to the Internet (this corresponds to 3GPP’s N6 interface) and is assigned IP subnet 192.168.250.0/24 .

<![if !vml]>![](file:///installimage020.gif)The above output from ip shows the two interfaces visible to the server, but running outside

the container.

###  Check core and access are properly configured inside the container

kubectl can be used to see what’s running inside the UPF, where bessd is the name of the container image that implements the UPF, and access and core are the last two interfaces shown below:

<![if !vml]>![](file:///installimage022.gif)

When packets flowing upstream from the gNB arrive on the server’s physical interface, they need to be forwarded over the access interface. This is done by having the following kernel route installed, which should be the case if your Aether installation was successful.

_route -n | grep "Iface\|access”_

<![if !vml]>![](file:///installimage024.gif)

Within the UPF, the correct behavior is to forward packets between the access and core

interfaces. Upstream packets arriving on the access interface have their GTP headers

removed and the raw IP packets are forwarded to the core interface. The routes inside the UPF’s bessd container will look something like this:

<![if !vml]>![](file:///installimage026.gif)

<![if !vml]>![](file:///installimage028.gif)

The first rule above matches packets to the UEs on the 172.250.0.0/16 subnet. The next hop for these packets is the core IP address inside the UPF. The second rule says that next hop address is reachable on the core interface outside the UPF. As a result, the downstream packets arrive in the UPF where they are GTP-encapsulated with the IP address of the gNB.

Note that if you are not finding access and core interfaces outside the UPF, the following commands can be used to create these two interfaces manually (again using our running example for the physical ethernet interface):

_ip link add core link ens3 type macvlan mode bridge 192.168.250.3_

_ip link add access link ens3 type macvlan mode bridge 192.168.252.3_

Note that if you are find access and core interfaces outside the UPF, but route not generated the following commands can be used to create these two routes manually (again using our running example for the physical ethernet interface):

_sudo ip route add 192.168.252.0/24 dev access_

_sudo ip route add 192.168.250.0/24 dev core_

###  Packet Traces

Packet traces are the best way to diagnose your deployment, and the most helpful traces you can capture are shown in the following commands. You can run these on the Aether server, where we use our example ens18 interface for illustrative purposes:

_sudo tcpdump -i any sctp -w sctp-test.pcap_

_sudo tcpdump -i ens18 port 2152 -w gtp-outside.pcap_

_sudo tcpdump -i access port 2152 -w gtp-inside.pcap_

_sudo tcpdump -i core net 172.250.0.0/16 -w n6-inside.pcap_

_sudo tcpdump -i ens18 net 172.250.0.0/16 -w n6-outside.pcap_

If the gtp-outside.pcap has packets and the gtp-inside.pcap is empty (no packets captured), you may run the following commands to make sure packets are forwarded from the ens18 interface to the access interface and vice versa:

_sudo iptables -A FORWARD -i ens18 -o access -j ACCEPT_

_sudo iptables -A FORWARD -i access -o ens18 -j ACCEPT_

##   Routing Configuration inside UPF pod

###  Enter the UPF Pod

To enter the UPF pod, execute the following commands:

_kubectl exec -it upf-0 -n ios-mcn bash_

Once inside the pod, verify the network interfaces:

_ip addr_

Ensure the following four interfaces are created: lo, eth0, access, and core.

<![if !vml]>![](file:///installimage030.gif)

####  Verify Routing Table

Check the routing table to ensure it matches the expected configuration

_ip r_

<![if !vml]>![](file:///installimage032.gif)

####  Ping test

### <![if !vml]>![](file:///installimage034.gif)

####  Check and Update ARP Entries

<![if !vml]>![](file:///installimage036.gif)

Ensure that the ARP entries for access and core interfaces have the correct MAC addresses. If the MAC addresses do not match, update them as follows:

_sudo arp -s 192.168.252.3 <mac-address-access>_

_sudo arp -s 192.168.250.3 <mac-address-core>_

Replace <mac-access> and <mac-core> with the actual MAC addresses of the access and core interfaces respectively [Inside UPF-POD].

## Related Artifacts & links

| **Document Name** | **Purpose** | **Link** |
|--|--|--|
| User Guide | Quick start guide | |
| Installation Guide | Installation of SD-Core |
| Troubleshooting Guide  | Troubleshooting guide for SD-Core | |
| Developer Guide | Guide for SD-Core developers | |


